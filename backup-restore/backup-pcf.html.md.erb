---
title: Backing Up Pivotal Cloud Foundry
owner: RelEng
---

<strong><%= modified_date %></strong>

<% $this_topic = 'backup-pcf' %>

This topic describes the procedure for backing up your critical backend PCF components with BOSH Backup and Restore (BBR), a command-line tool for backing up and restoring BOSH deployments. To restore your backup, see the [Restoring Pivotal Cloud Foundry from Backup](restore-pcf.html) topic.

<p class="note"><strong>Note</strong>: To back up PCF manually, see the <a href="backup-pcf-manual.html">Backing Up Pivotal Cloud Foundry Manually</a> topic.</p>

Pivotal recommends the following:

* Back up your installation settings frequently, especially before making any changes to your PCF deployment, such as configuration of any tiles in Ops Manager.
* Make redundant copies of your backups and store them in multiple locations in order to minimize the risk of losing your backups in the event of a disaster.
* Attempt a test restore on every backup in order to validate it.

## <a id='overview'></a>Overview

BBR is a binary that runs backup scripts included with BOSH releases. BBR backs up the following PCF components:

* Elastic Runtime

Operators download the BBR binary and transfer it to a jumpbox. Then they run BBR from the jumpbox, specifying the name of the BOSH deployment to back up.

BBR examines the jobs in the BOSH deployment, and triggers the backup script for each release in the prescribed order. The backup artifacts are drained to the jumpbox, where the operator can transfer them to storage and use them to [restore](restore-pcf.html) PCF.

The following diagram shows a sample backup flow.

**This is where we put the diagram.**

## <a id='encrypt-key'></a>Step 1: Record the Cloud Controller Database Encryption Credentials ##

From the **Installation Dashboard**, select **Pivotal Elastic Runtime > Credentials** and locate the Cloud Controller section.
Record the Cloud Controller **DB Encryption Credentials**.
You must provide these credentials if you contact Pivotal Support for help
restoring your installation.

<%= image_tag("ccdb-encrypt-creds.png") %>

## <a id='export'></a>Step 2: Export Installation Settings ##

Pivotal recommends that you back up your installation settings by exporting
frequently. This option is only available after you have deployed at least one time.
Always export an installation before following the steps in the [Import Installation Settings](./restore-pcf.html#import) section of the [Restoring Pivotal Cloud Foundry from Backup](./restore-pcf.html) topic.

<p class="note"><strong>Note</strong>: Exporting your installation only backs up your installation settings. It does not back up your virtual machines (VMs) or any external MySQL databases.</p>

From the **Installation Dashboard** in the Ops Manager interface, click your user name at the top right navigation. Select **Settings**.

**Export installation settings** exports the current PCF installation
settings and assets.
When you export an installation, the exported file contains the base VM images,
all necessary packages, and references to the installation IP addresses.
As a result, an exported installation file can exceed 5 GB in size.

<%= image_tag("settings.png") %>

<p class='note'><strong>Note</strong>: For versions of Ops Manager 1.3 or older, the process of archiving files for export may exceed the timeout limit of 600 seconds and result in a <code>500</code> error. To resolve this issue, you can manually increase the timeout value, or assign additional resources to the Ops Manager VM to improve performance. For more information, see the <a href="https://support.pivotal.io/hc/en-us/articles/206113627">Pivotal Support Knowledge Base</a>.</p>


## <a id='jumpbox'></a>Step 1: Set Up Your Jumpbox

Set up your jumpbox with the following settings:

* The jumpbox must have sufficient space for the backup. A PCF backup will be at least 1.5 GB in size.
* BBR connects to the VMs at their private IP address, so the jumpbox needs to be in the same network as the deployed VMs. BBR does not support SSH gateways.
* BBR copies the backed-up data from the VMs to the jumpbox, so ensure you have minimal network latency between them to reduce transfer times.

Consult the following table for more information about the network access permissions required by BBR:

<table>
<tr>
<th>VM</th>
<th>Default Port</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>BOSH Director</td>
<td>25555</td>
<td>BBR interacts with the BOSH Director API.</td>
</tr>
<tr>
<td>Deployed Instances</td>
<td>22</td>
<td>BBR uses SSH to orchestrate the backup on the instances.</td>
</tr>
<tr>
<td>BOSH Director UAA</td>
<td>8443</td>
<td>BBR interacts with the UAA API for authentication, if necessary.</td>
</tr>
</table>

## <a id='scp'></a>Step 2: Transfer BBR to Your Jumpbox

Perform the following steps to transfer BBR to your jumpbox:

1. Download the latest BBR release.
1. Change the permissions of `bbr` in order to make it executable:
	<pre class="terminal">$ chmod a+x bbr</pre>
1. SCP the binary to your jumpbox:
	<pre class="terminal">$ scp LOCAL\_PATH\_TO\_BBR/bbr JUMPBOX\_USER/JUMPBOX\_ADDRESS</pre>
	If your jumpbox has access to the internet, you can also SSH into your jumpbox and use `wget`: 
	<pre class="terminal">
	$ ssh JUMPBOX\_USER/JUMPBOX\_ADDRESS -i YOUR\_CERTIFICATE.pem
	$ wget BBR\_RELEASE\_URL
	$ chmod a+x bbr
	</pre>

## <a id='obtain-values'></a>Step 3: Obtain Necessary Values

Perform the following steps to obtain the values needed to run BBR:

1. Obtain the IP address of the Ops Manager Director job by following the steps in the [Gather Information](../trouble-advanced.html#gather) section of the *Advanced Troubleshooting with the BOSH CLI* topic. This is the IP address of your BOSH Director.
1. Obtain your BOSH Director credentials by following the steps in the [Log into BOSH](../trouble-advanced.html#log-in) section of the *Advanced Troubleshooting with the BOSH CLI* topic. The procedures differ depending on whether your PCF deployment uses internal authentication or an external user store.
1. Obtain the name of the deployment you want to back up. **How do we get the deployment name? Would PCF be a single BOSH deployment?**

## <a id='check'></a> Check Your Deployment

Perform the following steps to check that your BOSH Director is reachable and has a deployment that can be backed up:

1. SSH into your jumpbox:
	<pre class="terminal">
	$ ssh JUMPBOX\_USER/JUMPBOX\_ADDRESS -i YOUR\_CERTIFICATE.pem
	</pre>
1. Run the BBR pre-backup check:
	<pre class="terminal">
	$ BOSH\_CLIENT\_SECRET=BOSH_PASSWORD \
  	bbr --target BOSH\_DIRECTOR\_IP \
  	--username BOSH\_USERNAME \
  	--deployment DEPLOYMENT\_NAME \
  	--ca-cert /var/tempest/workspaces/default/root\_ca\_certificate
    pre-backup-check</pre>

    If you are using internal authentication, your `BOSH_PASSWORD` is the password found under **Director Credentials** in the **Credentials** tab of Ops Manager and `BOSH_USERNAME` is `director`. See the previous [section](#obtain-values) for more information.
    <br><br>
    If you are using an external user store, `BOSH_PASSWORD` is your temporary authentication code and `BOSH_USERNAME` is `admin`. See the previous [section](#obtain-values) for more information. 
1. If the pre-backup check succeeds, continue to the [next section](#bbr-backup). If it fails, the deployment you selected may not have the correct backup scripts, or the connection to the BOSH Director may have failed. 

## <a id='bbr-backup'></a> Back Up Your Deployment


bbr stores each backup in the current working directory, in a directory of the same name as the deployment.


## <a id='export'></a>Export Installation Settings ##

**How does exporting installation settings fit into this?**

Pivotal recommends that you back up your installation settings by exporting
frequently. This option is only available after you have deployed at least one time.
Always export an installation before following the steps in the [Import Installation Settings](./restore-pcf.html#import) section of the [Restoring Pivotal Cloud Foundry from Backup](./restore-pcf.html) topic.

<p class="note"><strong>Note</strong>: Exporting your installation only backs up your installation settings. It does not back up your virtual machines (VMs) or any external MySQL databases.</p>

From the **Installation Dashboard** in the Ops Manager interface, click your user name at the top right navigation. Select **Settings**.

**Export installation settings** exports the current PCF installation
settings and assets.
When you export an installation, the exported file contains the base VM images,
all necessary packages, and references to the installation IP addresses.
As a result, an exported installation file can exceed 5 GB in size.

<%= image_tag("settings.png") %>

<p class='note'><strong>Note</strong>: For versions of Ops Manager 1.3 or older, the process of archiving files for export may exceed the timeout limit of 600 seconds and result in a <code>500</code> error. To resolve this issue, you can manually increase the timeout value, or assign additional resources to the Ops Manager VM to improve performance. For more information, see the <a href="https://support.pivotal.io/hc/en-us/articles/206113627">Pivotal Support Knowledge Base</a>.</p>



