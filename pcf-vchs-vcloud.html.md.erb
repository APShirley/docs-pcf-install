---
title: Deploying Operations Manager to vCHS and vCD
---

This topic is a prerequisite to [Configuring Ops Manager Director for vCHS and vCloud](./vchs-vcloud-config.html)

## <a id='configuring'></a>Configuring NAT Ruless ##

Elastic Runtime accesses the Internet using a source NAT rule (SNAT).

Elastic Runtime's API endpoint, which is fronted by HA Proxy, instance requires a destination NAT (DNAT) to forward traffic from a public IP. Ops Manager also requires a DNAT rule to connect to it from a public IP.

You need at least two public IP addresses for your virtual datacenter. One designated for Ops Manager and one for Elastic Runtime.

NAT rules are configured in the vShield Edge interface which will be described next.

### Configuring vShield Edge ###

Follow these steps to configure vShield NAT rules. For more informationedge gateway services, see the [VMware vCloud Director](http://pubs.vmware.com/vcd-51/index.jsp#com.vmware.vcloud.admin.doc_51/GUID-99A1DA05-AF6B-4F22-842E-92394B50F9A8.html) documentation.

#### Open the vShield Edge Gateway Services Interface ####

1. Log into vCHS and click on Gateways

1. Click on Manage Advanced Gateway Settings on the right hand side

1. Select the gateway you want to configure, then click the gear icon and select **Edge Gateway Services**.

    <%= image_tag("vcloud-vchs/select-edge.png") %>

#### <a id='connect'></a>Creating an SNAT and Firewall Rule ####

1. Configure an SNAT rule allowing outbound connections through Ops Manager public IP address. Using the Elastic Runtime IP address can be problematic for DNS resolution.

    <%= image_tag("vcloud-vchs/snat-1.png") %>

1. Set up a firewall rule allowing outbound traffic from all internal IP
addresses to all IP external addresses.

    <%= image_tag("vcloud-vchs/firewall.png") %>

#### <a id='ssh'></a>Allow Inbound SSH for Ops Manager ####

You may need to SSH to your Ops Manager VM which requires a DNAT rule.

1. Create a destination NAT (DNAT) rule with the following configuration:
    * Applied on: Select your external network
    * Original (External) IP/range: Enter the public IP address for Ops Manager
    * Protocol: Select **TCP & UDP**
    * Original Port: Select **22**
    * Translated (Internal) IP/range: Enter the private IP address of your Ops Manager
    * Translated port: **22**

1. Create a firewall rule allowing inbound traffic from the public IP to the private IP address of your Ops Manager.

#### <a id='ssh'></a>Allow Inbound Web Traffic for Ops Manager ####

Repeat the steps above for ports 80, and 443 for the same public address.

#### <a id='ssh'></a>Allow Inbound Web Traffic for Elastic Runtime ####

Repeat the steps above for ports 80, and 443 for the Elastic Runtime public IP address.

#### <a id='er'></a>Set up Network Rules for Elastic Runtime DNS Resolution ####

1. In the edge gateway **Configure Services** screen, select the **Load
Balancer** tab.

1. Click **Pool Servers**, then click **Add**.

    <%= image_tag("vcloud-vchs/pool.png") %>

1. Name the pool **Load Balancer to Elastic Runtime**.

1. In the **Configure Service** step, enable the pool to support HTTP port 80
and HTTPS port 443.

    <%= image_tag("vcloud-vchs/ports.png") %>

1. In the **Configure Health-Check** step, enter Monitor Port **80** for HTTP
and **443** for HTTPS.
For both HTTP and HTTPS, change the Mode to **TCP**.

    <%= image_tag("vcloud-vchs/health-check.png") %>

1. In the **Manage Members** step, click **Add**.
Enter the IP address of the HA Proxy VM.

    <%= image_tag("vcloud-vchs/member.png") %>

1. Click **Finish**.

1. Click **Virtual Servers**.

    <%= image_tag("vcloud-vchs/virtual-servers.png") %>

1. Click **Add**.

1. Complete the new virtual server form with the following information:
    * Name: Load Balancer
    * Applied On: Select your external network
    * IP Address: Enter the public IP address of your Elastic Runtime instance
    * Pool: Select the **Load Balancer to Elastic Runtime** pool
    * Services: Enable HTTP on port 80, and HTTPS on port 443

1. Click **OK** to complete

    <%= image_tag("vcloud-vchs/complete.png") %>

## <a id='deploying'></a>Deploying Ops Manager to vCHS ##

The following procedure guides you through deploying Ops Manager as a vApp on vCHS or vCloud Director. Refer to the [Known Issues](../pcf-release-notes/p1-v1.2/opsmanager_ki.html) topic before getting started.

<p class="note"><strong>Note</strong>: The vCloud Director Web Console (also on vCHS) only supports 32-bit browsers, including Firefox. It does not support Chrome. Refer to Article 2034554 in the <a href="http://kb.vmware.com/selfservice/microsites/searchEntry.do">VMware Knowledge Base</a> for more information about browser versions that the vCloud Director supports.</p>

### <a id='choosing-vapp-on-vchs'></a>Locating Ops Manager on vCHS Public Catalog ##

1. Log into vCHS.

1. Choose the vDC env you want to deploy PCF

1. Click the link to open the vCD UI.

1. In the vDC UI, Navigate to **Catalogs > Public Catalog**.

1. Select **Pivotal Ops Manager vApp** from the Public Catalog.

    <%= image_tag("vcloud-vchs/pcf-vchs-pub-catalog.png") %><br />

1. Click **Add to Cloud**.

    <%= image_tag("vcloud-vchs/vchs-catalog-add.png") %><br />

### <a id='uploading-to-vcd'></a>Uploading Ops Manager to vCD ##

If you are not using vCHS, you must either upload the Ops Manager vApp into your catalog or use a vApp that was uploaded by a vCD administrator in your organization's catalog.

1. Download Pivotal CF Operations Manager for vCHS / vCloud from [Pivotal Network](https://network.gopivotal.com/products/pivotal-cf).

1. Log into vCloud.

1. Navigate to **Catalogs > My Organization’s Catalogs** and select a catalog or
click **Add** to create a new catalog.

    <%= image_tag("vcloud-vchs/pcf-vcloud-00.png") %><br />

    If you are creating a new catalog:
     + Enter a name for the new catalog and click **Next**.
     + Select a storage type and click **Next**.
     + Specify sharing (if needed) and click **Next**.
     + Review your settings and click **Finish**.

1. Navigate to the **vApp Templates** tab for your catalog and click **Upload**.

    <%= image_tag("vcloud-vchs/pcf-vcloud-02.png") %><br />

    <p class="note"><strong>Note</strong>: The first time you upload software to vCloud Director, you are
    required to install the <strong>Client Integration Plug-in</strong> and restart all
    browsers.</p>

1. Select **Local file** and browse to your **ova** file.

    <%= image_tag("vcloud-vchs/pcf-vcloud-03a.png") %><br />

1. Enter a name for your Ops Manager vApp, enter a description (optional), and
click **Upload**.

    <%= image_tag("vcloud-vchs/pcf-vcloud-03b.png") %><br />

    vCloud Director transfers the vApp Template (the OVF package) to a staging
    environment, then uploads it to your catalog.

1. Navigate to the **Home** view and click **Add vApp from Catalog**.

    <%= image_tag("vcloud-vchs/pcf-vcloud-07.png") %><br />

1. Select your Ops Manager vApp and click **Next**.

    <%= image_tag("vcloud-vchs/pcf-vcloud-09.png") %><br />

### <a id='deploying-from-catalog'></a>Deploying Ops Manager ##

After adding the Ops Manager vApp to your cloud you can finish the set up and deploy as follows:

1. Check the "I agree" checkbox to accept licenses and click **Next**.

1. Enter the name of your Ops Manager vApp, select the virtual data center where
the vApp should run, and click **Next**.

	<%= image_tag("vcloud-vchs/pcf-vcloud-11.png") %><br />

1. Choose a storage policy and click **Next**.

	<%= image_tag("vcloud-vchs/pcf-vcloud-12.png") %><br />

1. Set the network mapping **Destination** to the network name, set **IP
allocation** to `Static — Manual`, and click **Next**.

    <%= image_tag("vcloud-vchs/pcf-vcloud-13.png") %><br />

1. Enter the desired networking information, set an admin password for the Ops
Manager vApp, and click **Next**.

    <p class="note"><strong>Note</strong>: The order of the items on your screen may vary from the order
    shown here.</p>

	<%= image_tag("vcloud-vchs/pcf-vcloud-14.png") %><br />

1. Review the hardware specifications of the virtual machine and click **Next**.

1. In the **Ready to Complete** dialog, check the **Power on vApp After This
Wizard is Finished** checkbox and click **Finish**.

1. Navigate to the **Home** view to verify that your Ops Manager vApp is being
created.

    <%= image_tag("vcloud-vchs/pcf-vcloud-17.png") %><br />

1. Once the VM boots, the interface is available at the IP address you
specified.

[Return to the Getting Started Guide](../getstarted/index.html)
