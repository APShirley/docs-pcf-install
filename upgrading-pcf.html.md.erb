---
title: Upgrading Pivotal Cloud Foundry
owner: Ops Manager
---
 
<style>
    .note.warning {
        background-color: #fdd;
        border-color: #fbb
    }

    .note.warning:before {
        color: #f99;
     }
</style>
 
<strong><%= modified_date %></strong>

This topic describes upgrading Pivotal Cloud Foundry to version 1.8. The upgrade procedures below describe upgrading Ops Manager, Elastic Runtime, RabbitMQ&reg;, Pivotal Cloud Foundry Metrics, and other product tiles. 

<p class="note warning">
<strong>WARNING: </strong> Ops Manager operates in lockstep with Pivotal Elastic Runtime and other service products. You must <a href="#review-lockstep"> Review Product Lockstep Versions</a> before proceeding with this upgrade procedure. Your upgrade will fail if you do not have compatible product versions associated with your Ops Manager installation.
</p>

<p class="note"><strong>Note</strong>: The apps in your deployment continue to run during the upgrade. However, you cannot write to your deployment or make changes to apps during the upgrade.</p>

**Important**: Read the Known Issues section of the [Pivotal Cloud Foundry&reg;](https://network.pivotal.io/products/pivotal-cf) (PCF)
[Release Notes](../pcf-release-notes/index.html) before getting started.

## <a id="beforeupgrade"></a>Before You Upgrade

This section contains important guidelines that you must follow before beginning an upgrade to PCF 1.8. Failure to follow these instructions may jeopardize your existing deployment data or cause your upgrade to fail.

The tasks you need to complete before upgrade fall into three categories: 

+ [Review Product Lockstep Versions](#review-lockstep) - review prerequisite product version before exporting your installation and applying changes
+ [Prepare Your Environment](#prepare-env) — includes making sure you have sufficient disk space.
+ [Prepare Databases and Apps](#prepare-db) — includes backing up data  
+ [Check System Health](#check-health) — perform a health check of your system, from virtual machines (VMs) to service tiles. 

### <a id="review-lockstep"></a>Review Product Lockstep Versions

1. Before you [export your installation](#keep), you must be using [Elastic Runtime (ERT)](./upgrading-products.html) version 1.7.12 or higher. 

1. Before you [export your installation](#keep) settings below, and if you are using RabbitMQ&reg;, you must upgrade to [version 1.6.4](http://docs.pivotal.io/rabbitmq-cf/index.html) or higher. 

1. After you import your installation setting, you must upgrade the following tiles if you use them before clicking **Apply Changes** in the new Ops Manager 1.8. **Installation Dashboard**. You cannot complete the upgrade if you fail to upgrade to these product versions:
    * Upgrade [Elastic Runtime](https://network.pivotal.io/products/elastic-runtime) to 1.8.x
    * Upgrade [RabbitMQ](http://docs.pivotal.io/rabbitmq-cf/index.html) to 1.7.x
    * Upgrade Pivotal [Single Sign-On Service](http://docs.pivotal.io/p-identity/index.html) to 1.2.x
    * Upgrade [PCF Metrics](http://docs.pivotal.io/pcf-metrics/index.html) to 1.1.x

### <a id="prepare-env"></a>Prepare Your Environment for Upgrade

1. Install the releases from your currently deployed 
version to the target version in sequential order. For example, if your deployment uses Ops Manager release 1.6 and you are upgrading to 1.8, 
you must sequentially install 1.7 and 1.8.

1. Ensure that every product tile on the Installation Dashboard is compatible with the new version of Ops Manager. For specific compatibility information, refer to the full [Product Version  Matrix](http://docs-pivotal.io/compatibility-matrix.pdf).
If a product does not meet this requirement, you must upgrade the product or
remove the tile before upgrading Ops Manager.

1. For each product tile you have installed, review the upgrade documentation that is specific to the tile. For example, if you have RabbitMQ, you need to increase the number of HAproxy instances from one to two. See [RabbitMQ for Pivotal Cloud Foundry Upgrades](http://docs.pivotal.io/rabbitmq-cf/upgrade.html).

1. <%= partial 'check_disk_before_upgrade' %>

1. If you have disabled lifecycle errands  for any installed product in order to reduce deployment time, Pivotal recommends that you re-enable these errands before upgrading. See <a href="./add-delete.html#add-import">Adding and Deleting Products</a> for more  information.

1. Ensure that the VM resurrector is turned off:
   1. From your Installation Dashboard, select the **Ops Manager Director** tile. 
   2. Click **Director Config**.
   3. Clear the **Enable VM resurrector plugin** checkbox.

1. If you are upgrading a vSphere environment, ensure that you have the following information about your existing environment before starting the upgrade:
  * Note these IP addresses, which can be found in the vSphere web client, **Manage** > **Settings** > **vApp Options**.
    This is the same information you entered at the end of deploying [Ops Manager on vSphere](http://docs.pivotal.io/1.6/pivotalcf/customizing/deploying-vm.html). 
     * IP Address of the Ops Manager
     * Netmask
     * Default Gateway
     * DNS Servers
     * NTP Servers
  * Note this VM hardware information so you can set up the new VM with similar settings. You can find this in the vSphere web 
client, **Manage** > **Settings** > **VM Hardware**.
     * CPU
     * Memory
     * Hard Disk 1
     * Network Adapter 1 - When you set up the new VM, ensure your network adapters are configured properly and are on the same network.

### <a id="prepare-db"></a>Prepare Databases and Apps for Upgrade

Back up all critical data prior to upgrading to PCF 1.8. For example, to backup a 1.7 environment, follow these instructions <a href="http://docs.pivotal.io/pivotalcf/1.7/customizing/backup-restore/backup-pcf.html">Backing Up Pivotal Cloud Foundry</a>. <br>


### <a id="check-health"></a>Check System Health Before Upgrade

1. Run `bosh cloudcheck` to confirm that the VMs are healthy.  See the [BOSH Cloudcheck](./trouble-advanced.html#cck) topic.

1. Check the system health of installed products. In the Installation Dashboard, select the **Status** tab for each service tile. Confirm that all jobs are healthy.

1. (Optional) Check the logs for errors before proceeding with the upgrade.
See the [Viewing Logs in the Command Line Interface](../devguide/deploy-apps/streaming-logs.html#view) topic.  

1. There should be no outstanding changes in Ops Manager or any other tile. All tiles should be green.
Click **Apply Changes** if necessary.

1. After applying changes, click **Recent Install Logs** to confirm that the changes completed cleanly:
    ```
    Cleanup complete
    {"type": "step\_finished", "id": "clean\_up\_bosh.cleaning\_up"}
    Exited with 0.
    ```

## <a id="keep"></a>Upgrading with Installed Products ##

<p class="note warning">
<strong>WARNING: </strong> Before you export your installation settings below, you must be using Elastic Runtime 1.7.12 or higher.  If you are using RabbitMQ, you must be using 1.6.4 or higher.
</p>

Follow the steps below to upgrade Ops Manager and keep all installed products.

1. From the Product Dashboard, select **Actions > Export installation
settings**.

    <%= image_tag("./images/upgrading/upgrade_to_1.8.png") %>

    This exports the current PCF installation with all of its assets.
    When you export an installation, the export contains the base VM images and
    necessary packages, and references to the installation IP addresses.
    As a result, an exported file can be very large, as much as 5 GB or more.
    * The export time depends on the size of the exported file.
    * Some browsers do not provide feedback on the status of the export
      process, and may appear to hang.
    * Some operating systems may automatically unzip the exported installation.
      If this occurs, create a zip file of the unzipped export.

    <p class="note"><strong>Note</strong>: When creating a zip file of an
      unzipped export, do not start compressing at the “installation” folder
      level.
      Instead, start compressing at the level containing the <code>config.yml</code> file:</p>

    <%= image_tag("./images/upgrading/compress.png") %>

2. Download the latest Ops Manager VM Template from the [Pivotal
Network](https://network.pivotal.io/products/pivotal-cf) site.

1. Record the FQDN address of the existing Ops Manager VM.

1. To avoid conflicts, power off the existing Ops Manager VM.

1. Deploy the new Ops Manager VM:
    * [Launching an Ops Manager Director Instance on AWS](./cloudform-om-deploy.html)
    * [Provisioning the OpenStack Infrastructure](./openstack-setup.html)
    * [Deploying Operations Manager to vSphere](./deploying-vm.html)
    * [Deploying Operations Manager to vCloud Air and vCloud](./pcf-vchs-vcloud.html)

1. When redirected to the **Welcome to Ops Manager** page, select **Import Existing Installation**. 

    <%= image_tag("./images/upgrading/welcome.png") %>

1. When prompted, enter the following:
  * **Decryption Passphrase**, which is the same as your password. 
  * Click **Choose File** and browse to the installation zip file exported in Step 3 above.

    <%= image_tag("./images/upgrading/decryption_passphrase.png") %>

1. Click **Import**.

    <p class="note"><strong>Note</strong>: 
      Some browsers do not provide feedback on the status of the import process,
      and may appear to hang.</p>

1. A "Successfully imported installation" message appears upon completion.

    <%= image_tag("./images/upgrading/success.png") %>

1. Before clicking **Apply Changes** in the new Ops Manager 1.8.**Installation Dashboard**, you must upgrade these tiles if you use them:
    * Upgrade [Elastic Runtime](https://network.pivotal.io/products/elastic-runtime) to 1.8.x
    * Upgrade [RabbitMQ](http://docs.pivotal.io/rabbitmq-cf/index.html) to 1.7.x
    * Upgrade Pivotal [Single Sign-On Service](http://docs.pivotal.io/p-identity/index.html) to 1.2.x
    * Upgrade [PCF Metrics](http://docs.pivotal.io/pcf-metrics/index.html) to 1.1.x

<p class="note warning">
<strong>WARNING: </strong> It is important to upgrade the products listed in the steps above before you click <strong>Apply Changes</strong>. You can optionally upgrade other products that are not listed in the steps above, but you will not be able to proceed until the step above is performed. 
</p>

1. (Optional) If you are using other service tiles, you can upgrade them now.

1. Click **Apply Changes**. This immediately imports and applies upgrades to all tiles in a single transaction.

1. Click each service tile, select the **Status** tab, and confirm that all VMs appear and are in good health.

1. Remove the original Ops Manager VM from your IaaS if the new installation functions correctly.



