---
title: Using SSL with a Self-Signed Certificate in Pivotal Ops Metrics
---

Secure Socket Layer (SSL) is a standard protocol for establishing an encrypted
link between a server and a client.
To communicate over SSL, a client needs to trust the SSL certificate of the
server.

There are two kinds of SSL certificates: signed and self-signed.

* **Signed**: A Certificate Authority (CA) signs the certificate.
A CA is a trusted third party that verifies your identity and certificate
request, then sends you a digitally signed certificate for your secure server.
Client computers automatically trust signed certificates.

* **Self-signed**: Your own server generates and signs the certificate.
Clients do not automatically trust self-signed certificates.
To communicate over SSL with a server providing a self-signed certificate, a
client must be explicitly configured to trust the certificate.

Clients keep all trusted certificates in a kind of keystore called a truststore.
To configure a client to trust a self-signed certificate, import the
self-signed certificate to a truststore on the client.

## <a id="enable"></a>Enabling SSL ##
To enable SSL, you must configure a PKCS#1 certificate in the release manifest.

1. Create a new private key.

    <pre class='terminal'>
    openssl genrsa -out privkey.pem 2048
    </pre>

1. Create a new server sign request from your private key.

    <pre class='terminal'>
    openssl req -new -key privkey.pem -out server.csr
    </pre>

1. Create a server cert.

    <pre class='terminal'>
    openssl x509 -req -days 365 -in server.csr -signkey privkey.pem -out   server.crt
    </pre>

1. Create a client keystore. This is to be used by the local JMX client, not the server.

    <pre class='terminal'>
    keytool -importcert -keystore metrics-store.jks -file server.crt
    </pre>

    Remember the password that you set for this keystore. Trust the certificate.

1. Use the `bosh edit deployment` command to update the manifest to include the private key and public certificate.

    <pre class='terminal'>
    bosh edit deployment
    </pre>

    Paste the key and cert into the correct fields `ssl_cert`, `ssl_private_key`:

    <pre class='terminal'>
  properties:
    maximus:
      username: USERNAME
      password: PASSWORD
      public_hostname: HOSTNAME
      use_ssl: true # This defaults to true, so you don't have to specify it
      ssl_cert: ! '-----BEGIN CERTIFICATE-----
        ...
        -----END CERTIFICATE-----'
      ssl_private_key: ! '-----BEGIN PRIVATE KEY-----
        ...
        -----END PRIVATE KEY----- '
    </pre>

1. Verify your settings by using the local JMX client of your choice. For this example, we will use `jconsole`. Use the keystore password from **Step 4** above in place of `$KEYSTORE_PASSWORD`:

   <pre class='terminal'>
   jconsole -J-Djavax.net.ssl.trustStore=metrics-store.jks -J-Djavax.net.ssl.trustStorePassword=$KEYSTORE_PASSWORD
   </pre>

You will use the IP address of the Maximus server and the port number 44444. The credentials are "admin/admin" by default
   and can be found on the "Credentials" tab of the Metrics tile in OpsManager.


## <a id="generate"></a>Generating a Self-Signed Certificate ##

To generate a self-signed certificate on your server:

1. In Pivotal Ops Manager, click the **Pivotal Ops Metrics** tile.
1. Check **Enable SSL**.
1. Click **Generate Self-Signed RSA Certificate** and check the **Trust Self-Signed Certificates** box.

    <%= image_tag("images/ssl/generate-ssl.png") %>

1. Enter your system and application domains in wildcard format.
Optionally, also add any custom domains in wildcard format.
Click **Generate.**

    <%= image_tag("images/ssl/generate.png") %>

1. Select and copy the certificate.

    <%= image_tag("images/ssl/copy.png") %>

1. Paste the certificate into a text file and save as `ops-metrics.cer`.

## <a id="import"></a>Importing the Self-signed Certificate to a Truststore ##

To import the self-signed certificate to your client:

1. Copy `ops-metrics.cer` from your server to your client.

1. Navigate to the client directory where you copied the saved certificate.

1. Run the keytool command:

    <pre class='terminal'>
    $ keytool -import -alias ops-metrics-ssl -file ops-metrics.cer -keystore localhost.truststore
    </pre>

    This command imports the certificate with an alias of `ops-metrics-ssl` to
    the truststore `localhost.truststore`.

    If `localhost.truststore` already exists, a prompt for the password appears.
    If `localhost.truststore` does not exist, you must create a password for it.

1. Verify the details of the imported certificate.

## <a id="start"></a>Starting a Monitoring Tool with the Truststore ##

Once you have imported the self-signed certificate to the `localhost.truststore`
truststore on the client, you must instruct your monitoring tool to use the
truststore.

On a command line, start your monitoring tool with the location and password of
the truststore:

* Pass the location of `localhost.truststore` to the monitoring tool using
the `javax.net.ssl.trustStore` property.

* Pass the truststore password using the `javax.net.ssl.trustStorePassword`
property.

Example starting jConsole:

<pre class='terminal'>
$ jconsole -J-Djavax.net.ssl.trustStore=/lib/home/jcert/localhost.truststore -J-Djavax.net.ssl.trustStorePassword=myPW
</pre>

Your monitoring tool now communicates with your server through the SSL
connection.